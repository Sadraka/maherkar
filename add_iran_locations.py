#!/usr/bin/env python
# -*- coding: utf-8 -*-

import requests
import json
import time

# تنظیمات اولیه
BASE_URL = "http://localhost:8000"  # آدرس API را اینجا تنظیم کنید
PROVINCES_ENDPOINT = f"{BASE_URL}/locations/provinces/"
CITIES_ENDPOINT = f"{BASE_URL}/locations/cities/"

# توکن دسترسی - این را باید با توکن خود جایگزین کنید
ACCESS_TOKEN = ""

# هدرهای درخواست
headers = {
    "Authorization": f"Bearer {ACCESS_TOKEN}",
    "Content-Type": "application/json",
    "Accept": "application/json"
}

# لیست استان‌ها و شهرهای ایران
iran_provinces_cities = {
    "آذربایجان شرقی": ["تبریز", "اهر", "آذرشهر", "بناب", "جلفا", "سراب", "مراغه", "مرند", "میانه", "هشترود", "بستان‌آباد", "شبستر", "عجب‌شیر", "کلیبر", "ملکان", "خداآفرین", "ورزقان"],
    
    "آذربایجان غربی": ["ارومیه", "اشنویه", "بوکان", "پیرانشهر", "تکاب", "خوی", "سردشت", "سلماس", "شاهین‌دژ", "ماکو", "مهاباد", "میاندوآب", "نقده", "چالدران", "پلدشت", "چایپاره", "شوط"],
    
    "اردبیل": ["اردبیل", "بیله‌سوار", "پارس‌آباد", "خلخال", "مشکین‌شهر", "نمین", "نیر", "گرمی", "کوثر", "سرعین"],
    
    "اصفهان": ["اصفهان", "آران و بیدگل", "اردستان", "برخوار", "تیران و کرون", "چادگان", "خمینی‌شهر", "خوانسار", "سمیرم", "شاهین‌شهر و میمه", "شهرضا", "فریدن", "فریدون‌شهر", "فلاورجان", "کاشان", "گلپایگان", "لنجان", "مبارکه", "نایین", "نجف‌آباد", "نطنز", "بویین و میاندشت", "خور و بیابانک"],
    
    "البرز": ["کرج", "ساوجبلاغ", "طالقان", "نظرآباد", "فردیس", "اشتهارد", "چهارباغ"],
    
    "ایلام": ["ایلام", "آبدانان", "ایوان", "دره‌شهر", "دهلران", "شیروان و چرداول", "ملکشاهی", "مهران", "بدره", "سیروان"],
    
    "بوشهر": ["بوشهر", "تنگستان", "جم", "دشتستان", "دشتی", "دیر", "دیلم", "کنگان", "گناوه", "عسلویه"],
    
    "تهران": ["تهران", "اسلامشهر", "بهارستان", "پاکدشت", "پردیس", "پیشوا", "دماوند", "رباط‌کریم", "ری", "شمیرانات", "شهریار", "فیروزکوه", "قدس", "قرچک", "ملارد", "ورامین"],
    
    "چهارمحال و بختیاری": ["شهرکرد", "اردل", "بروجن", "فارسان", "لردگان", "کوهرنگ", "کیار", "سامان", "بن", "خانمیرزا"],
    
    "خراسان جنوبی": ["بیرجند", "درمیان", "سرایان", "سربیشه", "فردوس", "قائنات", "نهبندان", "خوسف", "زیرکوه", "طبس", "بشرویه"],
    
    "خراسان رضوی": ["مشهد", "بردسکن", "تایباد", "تربت جام", "تربت حیدریه", "چناران", "خلیل‌آباد", "خواف", "درگز", "رشتخوار", "سبزوار", "سرخس", "فریمان", "قوچان", "کاشمر", "کلات", "گناباد", "نیشابور", "مه ولات", "جغتای", "جوین", "زاوه", "بجستان", "باخرز", "فیروزه", "خوشاب", "داورزن"],
    
    "خراسان شمالی": ["بجنورد", "اسفراین", "جاجرم", "شیروان", "فاروج", "مانه و سملقان", "گرمه", "راز و جرگلان"],
    
    "خوزستان": ["اهواز", "آبادان", "امیدیه", "اندیمشک", "اندیکا", "ایذه", "باغ‌ملک", "بندر ماهشهر", "بهبهان", "خرمشهر", "دزفول", "دشت آزادگان", "رامشیر", "رامهرمز", "شادگان", "شوش", "شوشتر", "گتوند", "لالی", "مسجد سلیمان", "هندیجان", "هفتگل", "هویزه", "آغاجاری", "کارون", "حمیدیه", "باوی"],
    
    "زنجان": ["زنجان", "ابهر", "ایجرود", "خدابنده", "خرمدره", "طارم", "ماهنشان", "سلطانیه"],
    
    "سمنان": ["سمنان", "دامغان", "گرمسار", "مهدی‌شهر", "شاهرود", "میامی", "آرادان", "سرخه"],
    
    "سیستان و بلوچستان": ["زاهدان", "ایرانشهر", "چابهار", "خاش", "دلگان", "زابل", "زهک", "سراوان", "سرباز", "کنارک", "نیکشهر", "هیرمند", "قصرقند", "مهرستان", "میرجاوه", "نیمروز", "هامون", "فنوج", "سیب و سوران"],
    
    "فارس": ["شیراز", "آباده", "اقلید", "بوانات", "پاسارگاد", "جهرم", "خرم‌بید", "خنج", "داراب", "رستم", "زرین‌دشت", "سپیدان", "سروستان", "فراشبند", "فسا", "فیروزآباد", "قیر و کارزین", "کازرون", "لارستان", "لامرد", "مرودشت", "ممسنی", "مهر", "نی‌ریز", "کوار", "خرامه", "گراش", "ارسنجان", "استهبان"],
    
    "قزوین": ["قزوین", "آبیک", "البرز", "بویین‌زهرا", "تاکستان", "آوج"],
    
    "قم": ["قم"],
    
    "کردستان": ["سنندج", "بانه", "بیجار", "دیواندره", "سروآباد", "سقز", "قروه", "کامیاران", "مریوان", "دهگلان"],
    
    "کرمان": ["کرمان", "بافت", "بردسیر", "بم", "جیرفت", "راور", "رفسنجان", "رودبار جنوب", "زرند", "سیرجان", "شهربابک", "عنبرآباد", "قلعه گنج", "کوهبنان", "کهنوج", "منوجان", "فهرج", "نرماشیر", "ارزوئیه", "ریگان", "فاریاب", "رابر", "انار"],
    
    "کرمانشاه": ["کرمانشاه", "اسلام‌آباد غرب", "پاوه", "ثلاث باباجانی", "جوانرود", "دالاهو", "روانسر", "سرپل ذهاب", "سنقر", "صحنه", "قصر شیرین", "کنگاور", "گیلان غرب", "هرسین"],
    
    "کهگیلویه و بویراحمد": ["یاسوج", "بویراحمد", "بهمئی", "چرام", "دنا", "کهگیلویه", "گچساران", "لنده", "باشت"],
    
    "گلستان": ["گرگان", "آزادشهر", "آق‌قلا", "بندر گز", "ترکمن", "رامیان", "علی‌آباد", "کردکوی", "کلاله", "گالیکش", "گمیشان", "گنبد کاووس", "مراوه‌تپه", "مینودشت"],
    
    "گیلان": ["رشت", "آستارا", "آستانه اشرفیه", "بندر انزلی", "رضوانشهر", "رودبار", "رودسر", "سیاهکل", "شفت", "صومعه‌سرا", "فومن", "لاهیجان", "لنگرود", "ماسال", "تالش", "املش"],
    
    "لرستان": ["خرم‌آباد", "ازنا", "الیگودرز", "بروجرد", "پلدختر", "دلفان", "دورود", "دوره", "رومشکان", "سلسله", "کوهدشت"],
    
    "مازندران": ["ساری", "آمل", "بابل", "بابلسر", "بهشهر", "تنکابن", "جویبار", "چالوس", "رامسر", "سوادکوه", "قائم‌شهر", "گلوگاه", "محمودآباد", "نکا", "نور", "نوشهر", "فریدونکنار", "عباس‌آباد", "سوادکوه شمالی", "کلاردشت", "سیمرغ", "میاندورود"],
    
    "مرکزی": ["اراک", "آشتیان", "تفرش", "خمین", "دلیجان", "زرندیه", "ساوه", "شازند", "کمیجان", "محلات", "خنداب", "فراهان"],
    
    "هرمزگان": ["بندرعباس", "ابوموسی", "بستک", "بشاگرد", "بندر لنگه", "پارسیان", "جاسک", "حاجی‌آباد", "خمیر", "رودان", "سیریک", "قشم", "میناب", "کیش"],
    
    "همدان": ["همدان", "اسدآباد", "بهار", "تویسرکان", "رزن", "فامنین", "کبودرآهنگ", "ملایر", "نهاوند", "درگزین"],
    
    "یزد": ["یزد", "ابرکوه", "اردکان", "بافق", "بهاباد", "تفت", "خاتم", "اشکذر", "مهریز", "میبد", "مروست"]
}

def get_all_provinces():
    """دریافت لیست تمام استان‌های موجود در سیستم"""
    response = requests.get(PROVINCES_ENDPOINT, headers=headers)
    if response.status_code == 200:
        return {p["name"]: p["id"] for p in response.json()}
    else:
        print(f"خطا در دریافت استان‌ها: {response.status_code}")
        print(response.text)
        return {}

def add_province(name):
    """اضافه کردن یک استان جدید"""
    data = {"name": name}
    response = requests.post(PROVINCES_ENDPOINT, headers=headers, json=data)
    if response.status_code == 201:
        print(f"استان '{name}' با موفقیت اضافه شد.")
        return response.json()["id"]
    else:
        print(f"خطا در افزودن استان '{name}': {response.status_code}")
        print(response.text)
        return None

def add_city(name, province_id):
    """اضافه کردن یک شهر جدید به یک استان"""
    data = {"name": name, "province_id": province_id}
    response = requests.post(CITIES_ENDPOINT, headers=headers, json=data)
    if response.status_code == 201:
        print(f"شهر '{name}' با موفقیت اضافه شد.")
        return True
    else:
        print(f"خطا در افزودن شهر '{name}': {response.status_code}")
        print(response.text)
        return False

def main():
    """تابع اصلی برای افزودن استان‌ها و شهرهای ایران"""
    if not ACCESS_TOKEN:
        print("لطفاً توکن دسترسی را در متغیر ACCESS_TOKEN تنظیم کنید.")
        return

    # دریافت لیست استان‌های موجود
    existing_provinces = get_all_provinces()

    # اضافه کردن استان‌ها و شهرها
    for province_name, cities in iran_provinces_cities.items():
        # بررسی اینکه آیا استان قبلاً اضافه شده است
        if province_name in existing_provinces:
            province_id = existing_provinces[province_name]
            print(f"استان '{province_name}' قبلاً اضافه شده است (ID: {province_id}).")
        else:
            # اضافه کردن استان جدید
            province_id = add_province(province_name)
            if province_id is None:
                continue

        
        # اضافه کردن شهرهای استان
        for city_name in cities:
            success = add_city(city_name, province_id)

            if not success:
                print(f"اضافه کردن شهر '{city_name}' با خطا مواجه شد.")

    print("عملیات با موفقیت به پایان رسید.")

if __name__ == "__main__":
    # تنظیم توکن دسترسی
    access_token = input("لطفاً توکن دسترسی خود را وارد کنید: ")
    ACCESS_TOKEN = access_token
    headers["Authorization"] = f"Bearer {access_token}"
    
    # اجرای برنامه
    main() 